function BBCodeButton(c){if(!c){return}var b=null;var a=this;var d=null;this.canInsert=function(){return b&&b.getTextArea()};this.getCode=function(){return d.name};this.getButtonGroup=function(){return b};this.addButtonGroup=function(e){b=e};this.insertCode=function(e){if(!this.canInsert()){return}var g=b.getTextArea();var f=g.getSelection();g.insertTextRange("["+this.getCode()+"]"+f+"[/"+this.getCode()+"]")};this.setHTMLElement=function(e){d=e;d.onclick=function(f){a.insertCode(this);return false}};this.getHTMLElement=function(e){return d};this.setHTMLElement(c)}function BBCodeLinkButton(d){this.constructor(d);var c="link";var e=new RegExp(/[http|https|ftp|ftps]:\/\/[a-zA-Z0-9-.][a-zA-Z0-9-.]+(S+)?/);var a=new RegExp(/[?|&]id=([0-9]+)/);var b=window.location.hostname+window.location.pathname;this.insertCode=function(h){if(!this.canInsert()){return}var f=this.getButtonGroup();var k=f.getTextArea();var j=k.getSelection().trim();var g=(e.test(j))?window.prompt(lang.bbcode_link_url,j):window.prompt(lang.bbcode_link_url,"http://");if(!g||g==""||g=="http://"){return}if(g.indexOf(b)>0&&a.test(g)){var i=a.exec(g);c="msg";g=i[1]}else{c="link"}if(j==""||e.test(j)){j=window.prompt(lang.bbcode_link_text,"")}if(j!=null){if(j!=""){k.insertTextRange("["+c+"="+g+"]"+j+"[/"+c+"]")}else{k.insertTextRange("["+c+"]"+g+"[/"+c+"]")}}}}function BBCodePromtButton(c,a,b){this.constructor(c);b=b||"";this.insertCode=function(f){if(!this.canInsert()){return}var d=this.getButtonGroup();var h=d.getTextArea();var g=h.getSelection().trim();if(g==""){var e=window.prompt(a,b);if(e&&e.trim()!=""&&e.trim()!=b){h.insertTextRange("["+this.getCode()+"]"+e+"[/"+this.getCode()+"]")}}else{h.insertTextRange("["+this.getCode()+"]"+g+"[/"+this.getCode()+"]")}}}function BBCodeColorChooserButton(c){this.constructor(c);var a=["#fff","#ccc","#c0c0c0","#999","#666","#333","#000","#fcc","#f66","#f00","#c00","#900","#600","#300","#fc9","#f96","#f90","#f60","#c60","#930","#630","#ff9","#ff6","#fc6","#fc3","#c93","#963","#633","#ffc","#ff3","#ff0","#fc0","#990","#660","#330","#9f9","#6f9","#3f3","#3c0","#090","#060","#030","#9ff","#3ff","#6cc","#0cc","#399","#366","#033","#cff","#6ff","#3cf","#36f","#33f","#009","#006","#ccf","#99f","#66c","#63f","#60c","#339","#309","#fcf","#f9f","#c6c","#c3c","#939","#636","#303"];var d=document.createElement("table");var b=document.createElementWithAttributes("tbody",[],d);var h=this;var j=document.createElementWithAttributes("tr",[],b);for(var e=0;e<a.length;e++){var g=document.createElementWithAttributes("td",[],j);g.style.backgroundColor=a[e];g.style.width="15px";g.style.height="15px";g.style.fontSize="15px";var f=document.createElementWithAttributes("a",[["href","#"],["extension","="+a[e]],["onclick",function(i){h.insertOptionCode(this);return false}]],g);f.style.display="block";f.appendChild(document.createTextNode(String.fromCharCode(160)));if((e+1)%7==0){var j=document.createElementWithAttributes("tr",[],b)}}this.insertOptionCode=function(l){if(!this.canInsert()){return}var i=this.getButtonGroup();var m=i.getTextArea();var k=this.getCode();m.insertTextRange("["+k+l.extension+"]"+m.getSelection()+"[/"+k+"]");i.getAdditionalOptionsWindow().enableOptionList(false)};this.insertCode=function(l){if(!this.canInsert()){return}var k=this.getButtonGroup();var m=k.getTextArea();selectionRange=m.getSelection();var i=document.getElementPoSi(l);k.getAdditionalOptionsWindow().setOptionList(d);k.getAdditionalOptionsWindow().enableOptionList(true,i)}}function BBCodeOptionButton(d,f){this.constructor(d);var h=document.createElement("ul");var a=this;for(var b=0;b<f.length;b++){var g=f[b];var c=document.createElementWithAttributes("li",[],h);var e=document.createElementWithAttributes("a",[["href","#"],["attribute",g.attribute],["onclick",function(i){a.insertOptionCode(this);return false}]],c);e.appendChild(document.createTextNode(g.label));h.appendChild(c)}this.insertOptionCode=function(k){if(!this.canInsert()){return}var i=this.getButtonGroup();var l=i.getTextArea();var j=codeend=this.getCode();if(k.attribute.toLowerCase()=="inlinecode"){j=codeend=k.attribute}if(k.attribute.trim()&&k.attribute.toLowerCase()!="inlinecode"){j+="="+k.attribute}l.insertTextRange("["+j+"]"+l.getSelection()+"[/"+codeend+"]");i.getAdditionalOptionsWindow().enableOptionList(false)};this.insertCode=function(k){if(!this.canInsert()){return}var j=this.getButtonGroup();var l=j.getTextArea();selectionRange=l.getSelection();var i=document.getElementPoSi(k);j.getAdditionalOptionsWindow().setOptionList(h);j.getAdditionalOptionsWindow().enableOptionList(true,i)}}function BBCodeListButton(a){this.constructor(a);this.insertCode=function(f){if(!this.canInsert()){return}var c=this.getButtonGroup();var h=c.getTextArea();var g=h.getSelection();var b="";var e=g.split(/(\n|\r|\r\n)+/);for(var d=0;d<e.length;d++){if(e[d].trim()!=""){b+="\r\n[*]"+e[d]}}if(b.trim()==""){b="\r\n[*]...\r\n[*]...\r\n[*]..."}h.insertTextRange("\r\n[list]"+b+"\r\n[/list]\r\n")}}function BBCodeSingleSmilieButton(a){this.constructor(a);this.insertCode=function(c){if(!this.canInsert()){return}var b=this.getButtonGroup();var e=b.getTextArea();var d=e.getSelection();e.insertTextRange(d+this.getCode()+" ")}}function BBCodeSmilieButton(d,f){this.constructor(d,f);var a=this;var c=document.createElementWithAttributes("div",[["id","additional-smilies"]],null);for(var b=0;b<f.length;b++){var e=document.createElementWithAttributes("a",[["href","#"],["title",f[b].title],["code",f[b].code],["onclick",function(g){a.insertOptionCode(this);return false}]],c);e.appendChild(f[b].label)}this.insertOptionCode=function(i){if(!this.canInsert()){return}var g=this.getButtonGroup();var j=g.getTextArea();var h=i.code;j.insertTextRange(j.getSelection()+h+" ");g.getAdditionalOptionsWindow().enableOptionList(false)};this.insertCode=function(i){if(!this.canInsert()){return}var h=this.getButtonGroup();var j=h.getTextArea();selectionRange=j.getSelection();var g=document.getElementPoSi(i);h.getAdditionalOptionsWindow().setOptionList(c);h.getAdditionalOptionsWindow().enableOptionList(true,g)}}function BBCodePopUpButton(c,d,b,a){this.constructor(c);b=typeof(b)!="number"?350:b;a=typeof(a)!="number"?350:a;var f=(screen.width-b)/2;var e=(screen.height-a)/4;this.insertCode=function(h){if(!this.canInsert()){return}var g=window.open(d,"MyLittleForum","height="+a+",width="+b+",left="+f+", top="+e+",scrollbars,resizable");window.mlfBBCodeButton=this;g.focus()}}BBCodeLinkButton.prototype=new BBCodeButton;BBCodeSmilieButton.prototype=new BBCodeButton;BBCodeSingleSmilieButton.prototype=new BBCodeButton;BBCodeColorChooserButton.prototype=new BBCodeButton;BBCodeOptionButton.prototype=new BBCodeButton;BBCodeListButton.prototype=new BBCodeButton;BBCodePopUpButton.prototype=new BBCodeButton;BBCodePromtButton.prototype=new BBCodeButton;function ButtonGroup(f){if(!f){return}var textarea=f.elements.text;if(!textarea){textarea=document.createElementWithAttributes("textarea",[["name","text"],["id","text"],["cols",80],["rows",20]],f)}var hasUserButtons=false;var buttons=[];var additionalOptionsWindow=null;var self=this;f.onsubmit=function(e){var error_message="";if(f.elements.name_required&&f.elements.name&&f.elements.name.value.trim()==""){error_message+="- "+lang.error_no_name+"\n"}if(f.elements.subject&&f.elements.subject.value.trim()==""){error_message+="- "+lang.error_no_subject+"\n"}if(f.elements.text_required&&f.elements.text&&f.elements.text.value.trim()==""){error_message+="- "+lang.error_no_text+"\n"}if(f.elements.terms_of_use_required&&f.elements.terms_of_use_agree&&f.elements.terms_of_use_agree.checked==false){error_message+="- "+lang.terms_of_use_error_posting+"\n"}if(error_message){window.alert(error_message);return false}if(document.getElementById("throbber-submit")){document.getElementById("throbber-submit").style.visibility="visible"}return true};convertInstructionsToSmilies=function(){if(!document.getElementById("smiley-bar")){return}var buttonBar=document.getElementById("smiley-bar");if(document.getElementById("smiley-instructions")){var el=document.getElementById("smiley-instructions").firstChild;var obj=null;var list=[];while(el!=null){if(el.nodeName&&el.nodeName.toLowerCase()=="dt"){obj={code:el.firstChild.nodeValue,title:el.title,classes:el.className,isSmilie:true,childs:[]}}else{if(obj&&el.nodeName&&el.nodeName.toLowerCase()=="dd"){obj.label=el.firstChild;if(obj.classes.search(/default/)!=-1){createSingleButton(obj,buttonBar)}else{list.push(obj)}obj=null}}el=el.nextSibling}if(list&&list.length>0){obj={code:"",title:lang.more_smilies_title,label:lang.more_smilies_label,classes:"more-smilies",isSmilie:true,childs:list};createSingleButton(obj,buttonBar)}}};var convertInstructionsToButton=function(){if(!document.getElementById("bbcode-bar")){return}var buttonBar=document.getElementById("bbcode-bar");if(document.getElementById("bbcode-instructions")){var el=document.getElementById("bbcode-instructions").firstChild;var obj=null;while(el!=null){if(el.nodeName&&el.nodeName.toLowerCase()=="dt"){if(obj){createSingleButton(obj,buttonBar)}obj={code:el.id,label:el.title,title:el.firstChild.nodeValue,classes:el.className,childs:[]}}else{if(obj&&el.nodeName&&el.nodeName.toLowerCase()=="dd"){var attChild={attribute:el.id,label:el.title};obj.childs.push(attChild)}}el=el.nextSibling}if(obj){createSingleButton(obj,buttonBar)}}};var addButton=function(button,isUserButton){isUserButton=isUserButton||false;if(button instanceof BBCodeButton){button.addButtonGroup(self);if(isUserButton||!hasUserButtons){buttons[button.getCode()]=button}else{if(buttons[button.getCode()]){var firstHtmlEl=buttons[button.getCode()].getHTMLElement();var lastHtmlEl=button.getHTMLElement();button.setHTMLElement(firstHtmlEl);lastHtmlEl.parentNode.removeChild(lastHtmlEl);buttons[button.getCode()]=button}else{if(!isUserButton&&hasUserButtons){var htmlEl=button.getHTMLElement();htmlEl.parentNode.removeChild(htmlEl)}}}}};var createSingleButton=function(obj,buttonBar){var par=[["className",obj.classes],["name",obj.code],["type","button"],["title",obj.title]];var id=obj.code.trim()==""?"bbcodebutton":"bbcodebutton-"+obj.code;if(obj.isSmilie){par.push(["isSmilie",obj.isSmilie])}else{par.push(["id",id])}var b=document.createElementWithAttributes("button",par,buttonBar);var buttonSpan=document.createElement("span");if(typeof obj.label=="string"){buttonSpan.appendChild(document.createTextNode(obj.label))}else{buttonSpan.appendChild(obj.label)}b.appendChild(buttonSpan);addButton(createBBCodeButton(b,obj.childs))};var createBBCodeButton=function(button,list){var bbCodeButton=null;switch(button.name.toLowerCase()){case"link":bbCodeButton=new BBCodeLinkButton(button);break;case"img":bbCodeButton=new BBCodePromtButton(button,lang.bbcode_image_url,"http://");break;case"color":bbCodeButton=new BBCodeColorChooserButton(button);break;case"list":bbCodeButton=new BBCodeListButton(button);break;case"flash":bbCodeButton=new BBCodePopUpButton(button,"index.php?mode=insert_flash",settings.flash_popup_width,settings.flash_popup_height);break;case"upload":bbCodeButton=new BBCodePopUpButton(button,"index.php?mode=upload_image",settings.upload_popup_width,settings.upload_popup_height);break;case"tex":bbCodeButton=new BBCodePromtButton(button,lang.bbcode_tex_code);break;default:if(button.isSmilie&&list&&list.length>1){bbCodeButton=new BBCodeSmilieButton(button,list)}else{if(button.isSmilie){bbCodeButton=new BBCodeSingleSmilieButton(button)}else{if(list&&list.length>1){bbCodeButton=new BBCodeOptionButton(button,list)}else{bbCodeButton=new BBCodeButton(button)}}}break}return bbCodeButton};var createAdditionalOptionsWindow=function(){var isIE=
/*@cc_on!@*/
false;var w=document.createElementWithAttributes("div",[["id","bbcode-options"]],document.body);var content=document.createElementWithAttributes("div",[],w);w.style.display="none";w.style.position="absolute";var timeout=null;w.onmouseover=function(e){if(timeout){window.clearTimeout(timeout)}};w.onmouseout=function(e){e=e||window.event;var toElement=e.relatedTarget||e.toElement||false;var self=this;if(!this.contains(toElement)){timeout=window.setTimeout(function(){self.enableOptionList(false)},125)}return false};w.setOptionList=function(list){if(!content.firstChild){content.appendChild(list)}else{content.replaceChild(list,content.firstChild)}};w.enableOptionList=function(enable,pos){if(pos){this.style.left=pos.left+"px";this.style.top=pos.top+"px"}this.style.display=enable?"":"none"};var oldOnKeyPressFunc=window.document.onmousedown;window.document.onkeypress=function(e){var keyCode=document.getKeyCode(e);if(keyCode==27){self.enableOptionList(false)}if(typeof oldOnKeyPressFunc=="function"){oldOnKeyPressFunc(e)}};return w};var initUserBBCodeButtons=function(isSmilie){isSmilie=isSmilie||false;hasUserButtons=false;var id=isSmilie?"smiley-bar":"bbcode-bar";if(!document.getElementById(id)){return}var userButtons=document.getElementById(id).getElementsByTagName("button");if(userButtons&&userButtons.length>0){for(var i=0;i<userButtons.length;i++){hasUserButtons=true;userButtons[i].isSmilie=isSmilie;addButton(createBBCodeButton(userButtons[i],null),true)}}};var initTextArea=function(){textarea.quote="";if(document.getElementById("quote")&&document.getElementById("quote").value=="true"){textarea.quote=textarea.value;textarea.value=""}textarea.getQuote=function(){return textarea.quote.trim()};if(textarea.getQuote()!=""&&document.getElementById("message")){var labels=document.getElementById("message").getElementsByTagName("label");var label=null;for(var i=0;i<labels.length;i++){if(labels[i].className.search(/textarea/)!=-1){label=labels[i];break}}if(label){label.appendChild(document.createTextNode(String.fromCharCode(160)));var quoteLink=document.createElementWithAttributes("a",[["onclick",function(e){textarea.value=textarea.getQuote()+"\r\n\r\n"+textarea.value;this.style.display="none";textarea.focus();return false}],["id","insert-quote"],["href",window.location.href],["title",lang.quote_title]],label);quoteLink.appendChild(document.createTextNode(lang.quote_label))}}textarea.getSelection=function(){this.focus();if(typeof this.selectionStart=="number"&&typeof this.selectionEnd=="number"){return this.value.substring(this.selectionStart,this.selectionEnd)}else{if(document.selection&&document.selection.createRange){return document.selection.createRange().text}else{return""}}};textarea.insertTextRange=function(range){this.focus();if(typeof this.selectionStart!="undefined"){var oldScrollTop=this.scrollTop;var s1=this.value.substring(0,this.selectionStart);var s2=range;var s3=this.value.substring(this.selectionEnd,this.textLength);this.value=s1+range+s3;this.selectionStart=s1.length;this.selectionEnd=s1.length+range.length;this.scrollTop=oldScrollTop;this.focus()}else{if(document.selection&&document.selection.createRange){var sel=document.selection.createRange();sel.text=range;sel.select()}else{this.value+=range}}}};this.getTextArea=function(){return textarea};this.getAdditionalOptionsWindow=function(){return additionalOptionsWindow};var initDeleteCookieLink=function(){var span=null;if(!(span=document.getElementById("delete_cookie"))){return}var link=document.getFirstChildByElement(span,"a");link.onclick=function(e){document.cookie=settings.session_prefix+"userdata=; expires=Thu, 01-Jan-70 00:00:01 GMT;";span.innerHTML="";if(f.elements.setcookie){f.elements.setcookie.checked=false}return false}};(function(){if(document.getElementById("bbcode-instructions")){document.getElementById("bbcode-instructions").style.display="none"}if(document.getElementById("smiley-instructions")){document.getElementById("smiley-instructions").style.display="none"}additionalOptionsWindow=createAdditionalOptionsWindow();initTextArea();initUserBBCodeButtons(false);convertInstructionsToButton();initUserBBCodeButtons(true);convertInstructionsToSmilies();initDeleteCookieLink()}())}var mlf=null;window.ready.push(function(){if(typeof settings=="object"&&typeof lang=="object"){new ButtonGroup(document.getElementById("postingform"))}});