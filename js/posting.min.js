function BBCodeButton(t){if(t){var e=null,n=this,i=null;this.canInsert=function(){return e&&e.getTextArea()},this.getCode=function(){return i.name},this.getButtonGroup=function(){return e},this.addButtonGroup=function(t){e=t},this.insertCode=function(t){if(this.canInsert()){var n=e.getTextArea(),i=n.getSelection();n.insertTextRange("["+this.getCode()+"]"+i+"[/"+this.getCode()+"]")}},this.setHTMLElement=function(t){i=t,i.onclick=function(t){return n.insertCode(this),!1}},this.getHTMLElement=function(t){return i},this.setHTMLElement(t)}}function BBCodeLinkButton(t){this.constructor(t);var e="link",n=new RegExp(/[http|https|ftp|ftps]:\/\/[a-zA-Z0-9-.][a-zA-Z0-9-.]+(S+)?/),i=new RegExp(/[?|&]id=([0-9]+)/),o=window.location.hostname+window.location.pathname;this.insertCode=function(t){if(this.canInsert()){var s=this.getButtonGroup();window.setTimeout(function(){var t=s.getTextArea(),r=t.getSelection().trim(),l=n.test(r)?window.prompt(lang.bbcode_link_url,r):window.prompt(lang.bbcode_link_url,"http://");if(l&&""!=l&&"http://"!=l){if(l.indexOf(o)>0&&l.indexOf("mode=page")<0&&l.indexOf("mode=contact")<0&&i.test(l)){var u=i.exec(l);e="msg",l=u[1]}else e="link";(""==r||n.test(r))&&(r=window.prompt(lang.bbcode_link_text,"")),null!=r&&(""!=r?t.insertTextRange("["+e+"="+l+"]"+r+"[/"+e+"]"):t.insertTextRange("["+e+"]"+l+"[/"+e+"]"))}},150)}}}function BBCodePromtButton(t,e,n){this.constructor(t),n=n||"",this.insertCode=function(t){if(this.canInsert()){var i=this.getButtonGroup(),o=this.getCode();window.setTimeout(function(){var t=i.getTextArea(),s=t.getSelection().trim();if(""==s){var r=window.prompt(e,n);r&&""!=r.trim()&&r.trim()!=n&&t.insertTextRange("["+o+"]"+r+"[/"+o+"]")}else t.insertTextRange("["+o+"]"+s+"[/"+o+"]")},150)}}}function BBCodeColorChooserButton(t){this.constructor(t);for(var e=["#fff","#ccc","#c0c0c0","#999","#666","#333","#000","#fcc","#f66","#f00","#c00","#900","#600","#300","#fc9","#f96","#f90","#f60","#c60","#930","#630","#ff9","#ff6","#fc6","#fc3","#c93","#963","#633","#ffc","#ff3","#ff0","#fc0","#990","#660","#330","#9f9","#6f9","#3f3","#3c0","#090","#060","#030","#9ff","#3ff","#6cc","#0cc","#399","#366","#033","#cff","#6ff","#3cf","#36f","#33f","#009","#006","#ccf","#99f","#66c","#63f","#60c","#339","#309","#fcf","#f9f","#c6c","#c3c","#939","#636","#303"],n=document.createElement("table"),i=document.createElementWithAttributes("tbody",{},n),o=this,s=document.createElementWithAttributes("tr",{},i),r=0;r<e.length;r++){var l=document.createElementWithAttributes("td",{},s);l.style.backgroundColor=e[r],l.style.width="15px",l.style.height="15px",l.style.fontSize="15px";var u=document.createElementWithAttributes("a",{href:"#",extension:"="+e[r],onclick:function(t){return o.insertOptionCode(this),!1}},l);u.style.display="block",u.appendChild(document.createTextNode(String.fromCharCode(160))),(r+1)%7==0&&(s=document.createElementWithAttributes("tr",{},i))}this.insertOptionCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),n=e.getTextArea(),i=this.getCode();n.insertTextRange("["+i+t.extension+"]"+n.getSelection()+"[/"+i+"]"),e.getAdditionalOptionsWindow().enableOptionList(!1)}},this.insertCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),i=document.getElementPoSi(t);e.getAdditionalOptionsWindow().setOptionList(n),e.getAdditionalOptionsWindow().enableOptionList(!0,i)}}}function BBCodeOptionButton(t,e,n,i){if(this.constructor(t),e){n=n||!1,i=i||"";for(var o=document.createElement("ul"),s=this,r=0;r<e.length;r++){var l=e[r],u=document.createElementWithAttributes("li",{},o),d=document.createElementWithAttributes("a",{href:"#",attribute:l.attribute,onclick:function(t){return s.insertOptionCode(this),!1}},u);d.appendChild(document.createTextNode(l.label)),o.appendChild(u)}this.insertOptionCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),o=this.getCode(),s=this.getCode();window.setTimeout(function(){var r=e.getTextArea(),l=r.getSelection();if("inlinecode"==t.attribute.toLowerCase()&&(o=s=t.attribute),t.attribute.trim()&&"inlinecode"!=t.attribute.toLowerCase()&&(o+="="+t.attribute),n&&""==l){var u=window.prompt(n,i);u&&""!=u.trim()&&u.trim()!=i&&r.insertTextRange("["+o+"]"+u+"[/"+s+"]")}else r.insertTextRange("["+o+"]"+l+"[/"+s+"]");e.getAdditionalOptionsWindow().enableOptionList(!1)},150)}},this.insertCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),n=document.getElementPoSi(t);e.getAdditionalOptionsWindow().setOptionList(o),e.getAdditionalOptionsWindow().enableOptionList(!0,n)}}}}function BBCodeListButton(t){this.constructor(t),this.insertCode=function(t){if(this.canInsert()){for(var e=this.getButtonGroup(),n=e.getTextArea(),i=n.getSelection(),o="",s=i.split(/(\n|\r|\r\n)+/),r=0;r<s.length;r++)""!=s[r].trim()&&(o+="\r\n[*]"+s[r]);""==o.trim()&&(o="\r\n[*]...\r\n[*]...\r\n[*]..."),n.insertTextRange("\r\n[list]"+o+"\r\n[/list]\r\n")}}}function BBCodeSingleSmilieButton(t){this.constructor(t),this.insertCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),n=e.getTextArea(),i=n.getSelection();n.insertTextRange(i+this.getCode()+" ")}}}function BBCodeSmilieButton(t,e){this.constructor(t,e);for(var n=this,i=document.createElementWithAttributes("div",{id:"additional-smilies"},null),o=0;o<e.length;o++){var s=document.createElementWithAttributes("a",{href:"#",title:e[o].title,code:e[o].code,onclick:function(t){return n.insertOptionCode(this),!1}},i);s.appendChild(e[o].label)}this.insertOptionCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),n=e.getTextArea(),i=t.code;n.insertTextRange(n.getSelection()+i+" "),e.getAdditionalOptionsWindow().enableOptionList(!1)}},this.insertCode=function(t){if(this.canInsert()){var e=this.getButtonGroup(),n=document.getElementPoSi(t);e.getAdditionalOptionsWindow().setOptionList(i),e.getAdditionalOptionsWindow().enableOptionList(!0,n)}}}function BBCodePopUpButton(t,e,n,i){this.constructor(t),n="number"!=typeof n?350:n,i="number"!=typeof i?350:i;var o=(screen.width-n)/2,s=(screen.height-i)/4;this.insertCode=function(t){if(this.canInsert()){var r=window.open(e,"MyLittleForum","height="+i+",width="+n+",left="+o+", top="+s+",scrollbars,resizable");window.mlfBBCodeButton=this,r.focus()}}}function ButtonGroup(t){if(t){var e=t.elements.text;e||(e=document.createElementWithAttributes("textarea",{name:"text",id:"text",cols:80,rows:20},t));var n=!1,i=[],o=null,s=this;t.onsubmit=function(e){var n="";return t.elements.name_required&&t.elements.name&&""==t.elements.name.value.trim()&&(n+="- "+lang.error_no_name+"\n"),t.elements.subject&&""==t.elements.subject.value.trim()&&(n+="- "+lang.error_no_subject+"\n"),t.elements.text_required&&t.elements.text&&""==t.elements.text.value.trim()&&(n+="- "+lang.error_no_text+"\n"),t.elements.terms_of_use_required&&t.elements.terms_of_use_agree&&0==t.elements.terms_of_use_agree.checked&&(n+="- "+lang.terms_of_use_error_posting+"\n"),n?(window.alert(n),!1):(document.getElementById("throbber-submit")&&(document.getElementById("throbber-submit").style.visibility="visible"),!0)},convertInstructionsToSmilies=function(){if(document.getElementById("smiley-bar")){var t=document.getElementById("smiley-bar");if(document.getElementById("smiley-instructions")){for(var e=document.getElementById("smiley-instructions").firstChild,n=null,i=[];null!=e;)e.nodeName&&"dt"==e.nodeName.toLowerCase()?n={code:e.firstChild.nodeValue,title:e.title,classes:e.className,isSmilie:!0,childs:[]}:n&&e.nodeName&&"dd"==e.nodeName.toLowerCase()&&(n.label=e.firstChild,-1!=n.classes.search(/default/)?u(n,t):i.push(n),n=null),e=e.nextSibling;i&&i.length>0&&(n={code:"",title:lang.more_smilies_title,label:lang.more_smilies_label,classes:"more-smilies",isSmilie:!0,childs:i},u(n,t))}}};var r=function(){if(document.getElementById("bbcode-bar")){var t=document.getElementById("bbcode-bar");if(document.getElementById("bbcode-instructions")){for(var e=document.getElementById("bbcode-instructions").firstChild,n=null;null!=e;){if(e.nodeName&&"dt"==e.nodeName.toLowerCase())n&&u(n,t),n={code:e.id,label:e.title,title:e.firstChild.nodeValue,classes:e.className,childs:[]};else if(n&&e.nodeName&&"dd"==e.nodeName.toLowerCase()){var i={attribute:e.id,label:e.title};n.childs.push(i)}e=e.nextSibling}n&&u(n,t)}}},l=function(t,e){if(e=e||!1,t instanceof BBCodeButton)if(t.addButtonGroup(s),e||!n)i[t.getCode()]=t;else if(i[t.getCode()]){var o=i[t.getCode()].getHTMLElement(),r=t.getHTMLElement();t.setHTMLElement(o),r.parentNode.removeChild(r),i[t.getCode()]=t}else if(!e&&n){var l=t.getHTMLElement();l.parentNode.removeChild(l)}},u=function(t,e){var n={className:t.classes,name:t.code,type:"button",title:t.title},i=""==t.code.trim()?"bbcodebutton":"bbcodebutton-"+t.code;t.isSmilie?n.isSmilie=t.isSmilie:n.id=i;var o=document.createElementWithAttributes("button",n,e),s=document.createElement("span");"string"==typeof t.label?s.appendChild(document.createTextNode(t.label)):s.appendChild(t.label),o.appendChild(s),l(d(o,t.childs))},d=function(t,e){var n=null,i=t&&t.name?t.name.toLowerCase():"";switch(i){case"link":n=new BBCodeLinkButton(t);break;case"img":n=e&&e.length>1?new BBCodeOptionButton(t,e,lang.bbcode_image_url,"http://"):new BBCodePromtButton(t,lang.bbcode_image_url,"http://");break;case"color":n=new BBCodeColorChooserButton(t);break;case"list":n=new BBCodeListButton(t);break;case"flash":n=new BBCodePopUpButton(t,"index.php?mode=insert_flash",settings.flash_popup_width,settings.flash_popup_height);break;case"upload":n=new BBCodePopUpButton(t,"index.php?mode=upload_image",settings.upload_popup_width,settings.upload_popup_height);break;case"tex":n=new BBCodePromtButton(t,lang.bbcode_tex_code);break;default:n=t.isSmilie&&e&&e.length>0?new BBCodeSmilieButton(t,e):t.isSmilie?new BBCodeSingleSmilieButton(t):e&&e.length>1?new BBCodeOptionButton(t,e):new BBCodeButton(t)}return n},c=function(){var t=document.createElementWithAttributes("div",{id:"bbcode-options"},document.body),e=document.createElementWithAttributes("div",{},t);t.style.display="none",t.style.position="absolute";var n=null;t.onmouseover=function(t){n&&window.clearTimeout(n)},t.onmouseout=function(t){t=t||window.event;var e=t.relatedTarget||t.toElement||!1,i=this;return this.contains(e)||(n=window.setTimeout(function(){i.enableOptionList(!1)},125)),!1},t.setOptionList=function(t){e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t)},t.enableOptionList=function(t,e){e&&(this.style.left=e.left+"px",this.style.top=e.top+"px"),this.style.display=t?"":"none"};var i=window.document.onmousedown;return window.document.onkeypress=function(t){var e=document.getKeyCode(t);27==e&&s.enableOptionList(!1),"function"==typeof i&&i(t)},t},a=function(t){t=t||!1,n=!1;var e=t?"smiley-bar":"bbcode-bar";if(document.getElementById(e)){var i=document.getElementById(e).getElementsByTagName("button");if(i&&i.length>0)for(var o=0;o<i.length;o++)n=!0,i[o].isSmilie=t,l(d(i[o],null),!0)}},m=function(){if(e.quote="",document.getElementById("quote")&&"true"==document.getElementById("quote").value&&(e.quote=e.value,e.value=""),e.getQuote=function(){return e.quote.trim()},""!=e.getQuote()&&document.getElementById("message")){for(var t=document.getElementById("message").getElementsByTagName("label"),n=null,i=0;i<t.length;i++)if(-1!=t[i].className.search(/textarea/)){n=t[i];break}if(n){n.appendChild(document.createTextNode(String.fromCharCode(160)));var o=document.createElementWithAttributes("a",{onclick:function(t){return e.value=e.getQuote()+"\r\n\r\n"+e.value,this.style.display="none",e.focus(),!1},id:"insert-quote",href:window.location.href,title:lang.quote_title},n);o.appendChild(document.createTextNode(lang.quote_label))}}e.getSelection=function(){return this.focus(),"number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd?this.value.substring(this.selectionStart,this.selectionEnd):document.selection&&document.selection.createRange?document.selection.createRange().text:""},e.insertTextRange=function(t){if(this.focus(),"undefined"!=typeof this.selectionStart){var e=this.scrollTop,n=this.value.substring(0,this.selectionStart),i=this.value.substring(this.selectionEnd,this.textLength);this.value=n+t+i,this.selectionStart=n.length,this.selectionEnd=n.length+t.length,this.scrollTop=e,this.focus()}else if(document.selection&&document.selection.createRange){var o=document.selection.createRange();o.text=t,o.select()}else this.value+=t}};this.getTextArea=function(){return e},this.getAdditionalOptionsWindow=function(){return o};var f=function(){var e=null;if(e=document.getElementById("delete_cookie")){var n=document.getFirstChildByElement(e,"a");n.onclick=function(n){return document.cookie=settings.session_prefix+"userdata=; expires=Thu, 01-Jan-70 00:00:01 GMT;",e.innerHTML="",t.elements.setcookie&&(t.elements.setcookie.checked=!1),!1}}};!function(){document.getElementById("bbcode-instructions")&&(document.getElementById("bbcode-instructions").style.display="none"),document.getElementById("smiley-instructions")&&(document.getElementById("smiley-instructions").style.display="none"),o=c(),m(),a(!1),r(),a(!0),convertInstructionsToSmilies(),f()}()}}BBCodeLinkButton.prototype=new BBCodeButton,BBCodeSmilieButton.prototype=new BBCodeButton,BBCodeSingleSmilieButton.prototype=new BBCodeButton,BBCodeColorChooserButton.prototype=new BBCodeButton,BBCodeOptionButton.prototype=new BBCodeButton,BBCodeListButton.prototype=new BBCodeButton,BBCodePopUpButton.prototype=new BBCodeButton,BBCodePromtButton.prototype=new BBCodeButton,window.ready.push(function(){"object"==typeof settings&&"object"==typeof lang&&new ButtonGroup(document.getElementById("postingform"))});